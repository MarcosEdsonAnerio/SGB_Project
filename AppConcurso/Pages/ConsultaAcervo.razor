@page "/consulta-acervo"
@using SGB_Project.Models
@using SGB_Project.Controllers
@inject ConsultaAcervoService AcervoService

<h3>Consulta ao Acervo</h3>

<EditForm Model="@filtros" OnValidSubmit="Consultar">
    <DataAnnotationsValidator />
    <div class="card mb-3">
        <div class="card-body row g-3">
            <div class="col-md-4">
                <label class="form-label">Título</label>
                <InputText class="form-control" @bind-Value="filtros.Titulo" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Autor</label>
                <InputText class="form-control" @bind-Value="filtros.Autor" />
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <div class="form-check">
                    <InputCheckbox class="form-check-input" @bind-Value="filtros.ApenasDisponiveis" />
                    <label class="form-check-label">Somente Disponíveis</label>
                </div>
            </div>
        </div>
        <div class="card-footer text-end">
            <button type="submit" class="btn btn-primary">Pesquisar</button>
        </div>
    </div>
</EditForm>

@if (resultados != null)
{
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Título</th>
                <th>Autor</th>
                <th>Estoque</th>
                <th>Disponível</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var livro in resultados)
            {
                <tr>
                    <td>@livro.Titulo</td>
                    <td>@livro.Autor</td>
                    <td>@livro.Estoque</td>
                    <td>@(livro.Disponivel ? "Sim" : "Não")</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p class="text-muted">Preencha os filtros e clique em "Pesquisar" para exibir os livros.</p>
}

@code {
    private FiltrosConsulta filtros = new();
    private List<ConsultaAcervoModel>? resultados;

    private async Task Consultar()
    {
        resultados = await AcervoService.ConsultarAsync(
            titulo: filtros.Titulo,
            autor: filtros.Autor,
            apenasDisponiveis: filtros.ApenasDisponiveis
        );
    }

    public class FiltrosConsulta
    {
        public string? Titulo { get; set; }
        public string? Autor { get; set; }
        public bool ApenasDisponiveis { get; set; } = true;
    }
}
